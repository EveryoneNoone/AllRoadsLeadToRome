# Проект сервиса Авторизации и аутентификации пользователей

Этот проект представляет собой микросервис авторизации, который использует ASP.NET Core и PostgreSQL для обработки запросов аутентификации и авторизации.

## Требования

Для запуска этого проекта вам понадобятся:

- Docker

## Сборка и Запуск

Чтобы собрать и запустить контейнеры, выполните следующие шаги:

1. Откройте терминал или командную строку.
2. Перейдите в директорию проекта, где находится `docker-compose.yml`(папка src\services\auth\WebApi).
3. Выполните команду:

```bash
docker-compose up --build
```

Эта команда соберет образы для всех сервисов, определенных в docker-compose.yml, и запустит их в контейнерах. Параметр --build указывает на необходимость пересборки образов, даже если они уже были собраны ранее.

После запуска сервисы будут доступны на следующих портах:
Swagger: http://localhost:8090
База данных: localhost:5433 (Порт может быть изменен в соответствии с конфигурацией docker-compose.yml)

## Остановка и Удаление Контейнеров

Чтобы остановить работающие контейнеры и удалить их, воспользуйтесь следующей командой:
```bash
docker-compose down
```
Эта команда остановит все сервисы и удалит контейнеры, созданные docker-compose up. Это не удалит созданные образы.

## Использование

По адресу http://localhost:8090/swagger/index.html находится сваггер. 
После логина и получения токена, его можно добавить в меню Authorize (справа вверху соответствующая кнопка).
В базу добавлен аккаунт Администратора:
логин admin@example.com
пароль Admin@123

## Добавление поддержки аутентификации и авторизации в микросервис
1. Добавить ссылку на проект AllRoadsLeadToRome.Core.Auth. Он содержит два расширяющих метода:
	- добавление поддержки авторизации
	- добавление поддержки Bearer аутентификации в Swagger
2. Добавить в WebApi проекте
```
builder.Services.AddCustomSwaggerGen();
builder.Services.AddCustomAuthentication(builder.Configuration);
```
3.  После `builder.Build();` добавить 
```
app.UseAuthentication();
app.UseRouting();
app.UseAuthorization();
```
4. В appsettings проекта добавить
```
  "JwtSettings": {
    "Secret": "YourVeryStrongAndLongSecretKey1234567890",
    "Issuer": "YourIssuer",
    "Audience": "YourAudience",
    "AccessTokenExpiration": 1800,
    "RefreshTokenExpiration": 2592000
  }
```
